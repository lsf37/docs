<!DOCTYPE html>
<!--
     SPDX-License-Identifier: CC-BY-SA-4.0
     SPDX-FileCopyrightText: 2020 seL4 Project a Series of LF Projects, LLC.
-->
<!-- Page last generated 2024-09-30 03:18:50 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Camkes 1 | seL4 docs</title>

    <!-- Our stylesheet and theme stylesheet.  Contains bootstrap. -->
    <link rel="stylesheet" href="/assets/css/style.css" type="text/css">
    <!-- Font awesome -->
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <!-- Pygments syntax highlighting  -->
    <link rel="stylesheet" href="/assets/css/highlighting/trac.css" type="text/css">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico"><script defer data-domain="docs.sel4.systems"
	    src="https://analytics.sel4.systems/js/script.js"></script></head>

  <body class="container-fluid">

    



<header>
  <ul class="row menu">
    <li class="col-xs-12 col-md-2" >
            <a href="https://sel4.systems" class="skip-icon">
              <img class="img-responsive" src="/assets/logo-text-white.svg" alt="seL4 logo" />
            </a>
    </li>
    <li class="col-xs-12 col-md-10 menu">
      <nav aria-label="Banner links">
        <h2><a href="/GettingStarted">Getting Started</a></h2>
        <h2><a href="/processes">Contributing</a></h2>
        <h2><a href="/projects">Projects</a></h2>
        <h2><a href="/Tutorials">Tutorials</a></h2>
        <iframe title="DuckDuckGo search bar" src="https://duckduckgo.com/search.html?site=docs.sel4.systems&prefill=Search%20sel4.systems" style="overflow:hidden;margin-bottom:10px; padding:0;height:40px;float:right;border-width: 0px"></iframe>
      </nav>
    </li>
  </ul>
  <div class="clear"></div>
  
<div class="breadcrumbs bootstrap hidden-sm-down">
  <nav class="sel-breadcrumb" aria-label="Breadcrumb" >
    <ol class=" list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">
      
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/">
              <span property="name"><b>seL4 Docs</b></span>
            </a>
            <meta property="position" content="1" />
        </li>
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/Tutorials/">
              <span property="name"><b>Tutorials</b></span>
            </a>
            <meta property="position" content="2" />
        </li>
      
        

        
          <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <span property="name">Camkes 1</span>
            <meta property="position" content="3" /></li>
          
    </ol>
  </nav>
  <nav class="sel-version" aria-label="Current Versions">
    <ol class="list-unstyled">
      <li class="list-unstyled text-right" style="margin-left:auto; padding:0rem 0rem;">
        Current versions:</li>
      <li class="list-unstyled text-right">
      <a href="/releases/sel4/13.0.0"><b>seL4-13.0.0</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/releases/microkit/1.4.1"><b>microkit-1.4.1</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/releases/camkes/camkes-3.11.0"><b>camkes-3.11.0</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/releases/capdl/0.3.0"><b>capDL-0.3.0</b></a></li>
      </ol>
  </nav>
  <div class='clear'></div>
</div>


</header>

    <main>
      <div class="row">
  <div class="hidden-xs col-sm-4 col-md-3 col-lg-2">
    


<div class="sidebar">


















    <ul class="nav nav-sidebar">
  
  
        <li class="">
            <a class="" href="/Tutorials/hello-world.html">Hello, World!</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/hello-camkes-0.html">Camkes</a>
        <li>
  
        <li class="active">
            <a class="" href="/Tutorials/hello-camkes-1.html">Camkes 1</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/hello-camkes-2.html">Camkes 2</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/hello-camkes-timer.html">Camkes 3</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-1.html">Dynamic Libraries 1</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-2.html">Dynamic Libraries 2</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-3.html">Dynamic Libraries 3</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-4.html">Dynamic Libraries 4</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/mcs.html">MCS</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/capabilities.html">Capabilities</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/untyped.html">Untyped</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/mapping.html">Mapping</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/threads.html">Threads</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/ipc.html">IPC</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/notifications.html">Notifications</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/interrupts.html">Interrupts</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/fault-handlers.html">Faults</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/camkes-vm-linux.html">Camkes VM Linux</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/camkes-vm-crossvm.html">Camkes Cross-VM communication</a>
        <li>
  
    </ul>

</div>


  </div>
  <div class="col-sm-8 col-md-9 col-lg-8 main">
    
      <nav aria-label="Table of Contents">
        <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#prerequisites">Prerequisites</a></li>
<li class="toc-entry toc-h2"><a href="#initialising">Initialising</a></li>
<li class="toc-entry toc-h2"><a href="#outcomes">Outcomes</a></li>
<li class="toc-entry toc-h2"><a href="#background">Background</a>
<ul>
<li class="toc-entry toc-h3"><a href="#components">Components</a></li>
<li class="toc-entry toc-h3"><a href="#connections">Connections</a></li>
<li class="toc-entry toc-h3"><a href="#interfaces">Interfaces</a></li>
<li class="toc-entry toc-h3"><a href="#component-source">Component source</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#exercises">Exercises</a>
<ul>
<li class="toc-entry toc-h3"><a href="#task-5">TASK 5</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#done">Done</a></li>
<li class="toc-entry toc-h2"><a href="#getting-help">Getting help</a></li>
</ul>
      </nav>
    
    <div class="content">
      
<!--
  Copyright 2017, Data61, CSIRO (ABN 41 687 119 230)

  SPDX-License-Identifier: BSD-2-Clause
-->

<h1 id="camkes-tutorial-1">CAmkES Tutorial 1</h1>

<p>This tutorial is an introduction to
CAmkES: bootstrapping a basic static CAmkES application, describing its
components, and linking them together.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li><a href="https://docs.sel4.systems/HostDependencies#camkes-build-dependencies">Set up your machine</a>.</li>
  <li><a href="https://docs.sel4.systems/Tutorials/hello-camkes-0">Camkes hello world</a></li>
</ol>

<h2 id="initialising">Initialising</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For instructions about obtaining the tutorial sources see https://docs.sel4.systems/Tutorials/#get-the-code</span>
<span class="c">#</span>
<span class="c"># Follow these instructions to initialise the tutorial</span>
<span class="c"># initialising the build directory with a tutorial exercise</span>
./init <span class="nt">--tut</span> hello-camkes-1
<span class="c"># building the tutorial exercise</span>
<span class="nb">cd </span>hello-camkes-1_build
ninja
</code></pre></div></div>

<h2 id="outcomes">Outcomes</h2>

<ol>
  <li>Understand the structure of a CAmkES application, as a described,
well-defined, static system.</li>
  <li>Understand the file-layout of a CAmkES ADL project.</li>
  <li>Become acquainted with the basics of creating a practical CAmkES application.</li>
</ol>

<h2 id="background">Background</h2>

<p>The fundamentals of CAmkES are the component, the interface and the connection.</p>

<h3 id="components">Components</h3>

<p><em>Components</em> are logical
groupings of code and resources. They communicate with other component
instances via well-defined interfaces which must be statically defined,
over communication channels. This tutorial will lead you through the
construction of a CAmkES application with two components: an Echo
server, and its Client that makes calls to it. These components are
defined when you initialise your build repository, found in
the following camkes file:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">hello-camkes-1/hello-1.camkes</code></li>
</ul>

<p>Find the Component manual section here:
<a href="https://github.com/seL4/camkes-tool/blob/master/docs/index.md#component">https://github.com/seL4/camkes-tool/blob/master/docs/index.md#component</a></p>

<h3 id="connections">Connections</h3>

<p>The second fundamental component of CAmkES applications
is the <em>Connection</em>: a connection is the representation of a method of
communication between two software components in CAmkES. The underlying
implementation may be shared memory, synchronous IPC, notifications or
some other implementation-provided means. In this particular tutorial,
we are using synchronous IPC. In implementation terms, this boils down
to the <code class="language-plaintext highlighter-rouge">seL4_Call</code> syscall on seL4.</p>

<p>Find the “Connection” keyword manual section here:
<a href="https://github.com/seL4/camkes-tool/blob/master/docs/index.md#connection">https://github.com/seL4/camkes-tool/blob/master/docs/index.md#connection</a></p>

<h3 id="interfaces">Interfaces</h3>

<p>All communications over a CAmkES connection must be well
defined: static systems’ communications should be able to be reasoned
about at build time. All the function calls which will be delivered over
a communication channel then, also are well defined, and logically
grouped so as to provide clear directional understanding of all
transmissions over a connection. Components are connected together in
CAmkES, yes – but the interfaces that are exposed over each connection
for calling by other components, are also described.</p>

<p>There are different
kinds of interfaces: 
-Dataports,
-Procedural interfaces,
-and Notifications.</p>

<p>This tutorial will lead you through the construction of a Procedural
interface, which is an interface over which function calls are made
according to a well-defined pre-determined API. The keyword for this
kind of interface in CAmkES is <code class="language-plaintext highlighter-rouge">procedure</code>. The definition of this
Procedure interface may be found here:
<code class="language-plaintext highlighter-rouge">hello-camkes-1/interfaces/HelloSimple.idl4</code></p>

<p>Find the “Procedure” keyword definition here:
<a href="https://github.com/seL4/camkes-tool/blob/master/docs/index.md#procedure">https://github.com/seL4/camkes-tool/blob/master/docs/index.md#procedure</a></p>

<h3 id="component-source">Component source</h3>

<p>Based on the ADL, CAmkES generates boilerplate which
conforms to your system’s architecture, and enables you to fill in the
spaces with your program’s logic. The two generated files in this
tutorial application are, in accordance with the Components we have
defined:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">hello-camkes-1/components/Echo/src/echo.c</code></li>
  <li><code class="language-plaintext highlighter-rouge">hello-camkes-1/components/Client/src/client.c</code></li>
</ul>

<p>Now when it comes to invoking the functions that were defined in the
Interface specification
(<code class="language-plaintext highlighter-rouge">hello-camkes-1/interfaces/HelloSimple.idl4</code>),
you must prefix the API function name with the name of the Interface
instance that you are exposing over the particular connection.</p>

<p>The reason for this is because it is possible for one component to
expose an interface multiple times, with each instance of that interface
referring to a different function altogether. For example, if a
composite device, such as a network card with with a serial interface
integrated into it, exposes two instances of a procedural interface that
has a particular procedure named <code class="language-plaintext highlighter-rouge">send()</code> – how will the caller of
<code class="language-plaintext highlighter-rouge">send()</code> know whether his <code class="language-plaintext highlighter-rouge">send()</code> is the one that is exposed over the
NIC connection, or the serial connection?</p>

<p>The same component provides both. Therefore, CAmkES prefixes the
instances of functions in an Interface with the Interface-instance’s
name. In the dual-function NIC device’s case, it might have a
<code class="language-plaintext highlighter-rouge">provides &lt;INTERFACE_NAME&gt; serial</code> and a <code class="language-plaintext highlighter-rouge">provides &lt;INTERFACE_NAME&gt; nic</code>.
When a caller wants to call for the NIC-send, it would call,
nic_send(), and when a caller wants to invoke the Serial-send, it would
call, “serial_send()”.</p>

<p>So if the <code class="language-plaintext highlighter-rouge">Hello</code> interface is provided once by <code class="language-plaintext highlighter-rouge">Echo</code> as <code class="language-plaintext highlighter-rouge">a</code>, you would
call for the <code class="language-plaintext highlighter-rouge">a</code> instance of Echo’s <code class="language-plaintext highlighter-rouge">Hello</code> by calling for <code class="language-plaintext highlighter-rouge">a_hello()</code>.
But what if Echo had provided 2 instances of the <code class="language-plaintext highlighter-rouge">Hello</code> interface, and
the second one was named <code class="language-plaintext highlighter-rouge">a2</code>? Then in order to call on that second
<code class="language-plaintext highlighter-rouge">Hello</code> interface instance on Echo, you would call <code class="language-plaintext highlighter-rouge">a2_hello()</code>.</p>

<h2 id="exercises">Exercises</h2>

<p><strong>Exercise</strong> First modify <code class="language-plaintext highlighter-rouge">hello-1.camkes</code>. Define instances of <code class="language-plaintext highlighter-rouge">Echo</code> and <code class="language-plaintext highlighter-rouge">Client</code> in the 
<code class="language-plaintext highlighter-rouge">composition</code> section of the ADL.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>assembly {
    composition {
         component EmptyComponent empty;
         // TODO remove the empty component, and define an Echo and a Client component
assembly {
    composition {
         component EmptyComponent empty;
         component Client client;
         component Echo echo;
</code></pre></div></div>

<p><strong>Exercise</strong> Now add a connection from <code class="language-plaintext highlighter-rouge">client.hello</code> to <code class="language-plaintext highlighter-rouge">echo.hello</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        /* hint 1: use seL4RPCCall as the connector (or you could use seL4RPC if you prefer)
         * hint 2: look at
         * https://github.com/seL4/camkes-tool/blob/master/docs/index.md#creating-an-application
         */
        connection seL4RPCCall hello_con(from client.hello, to echo.hello);
</code></pre></div></div>

<p><strong>Exercise</strong> Define the interface for hello in <code class="language-plaintext highlighter-rouge">interfaces/HelloSimple.idl4</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Simple RPC interface */</span>
<span class="n">procedure</span> <span class="n">HelloSimple</span> <span class="p">{</span>
    <span class="cm">/* TODO define RPC functions */</span>
    <span class="cm">/* hint 1: define at least one function that takes a string as input parameter. call it say_hello. no return value
     * hint 2: look at https://github.com/seL4/camkes-tool/blob/master/docs/index.md#creating-an-application
     */</span>
<span class="p">};</span>
</code></pre></div></div>

<p><strong>Exercise</strong> Implement the RPC hello function.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * CAmkES tutorial part 1: components with RPC. Server part.
 */</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="cm">/* generated header for our component */</span>
<span class="cp">#include</span> <span class="cpf">&lt;camkes.h&gt;</span><span class="cp">
</span><span class="cm">/* TASK 5: implement the RPC function. */</span>
<span class="cm">/* hint 1: the name of the function to implement is a composition of an interface name and a function name:
 * i.e.: &lt;interface&gt;_&lt;function&gt;
 * hint 2: the interfaces available are defined by the component, e.g. in hello-1.camkes
 * hint 3: the function name is defined by the interface definition, e.g. in interfaces/HelloSimple.idl4
 * hint 4: so the function would be: hello_say_hello()
 * hint 5: the CAmkES 'string' type maps to 'const char *' in C
 * hint 6: make the function print out a mesage using printf
 * hint 7: look at https://github.com/seL4/camkes-tool/blob/master/docs/index.md#creating-an-application
 */</span>
<span class="kt">void</span> <span class="nf">hello_say_hello</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Component %s saying: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">get_instance_name</span><span class="p">(),</span> <span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Exercise</strong> Invoke the RPC function in <code class="language-plaintext highlighter-rouge">components/Client/src/client.c</code>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * CAmkES tutorial part 1: components with RPC. Client part.
 */</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="cm">/* generated header for our component */</span>
<span class="cp">#include</span> <span class="cpf">&lt;camkes.h&gt;</span><span class="cp">
</span>
<span class="cm">/* run the control thread */</span>
<span class="kt">int</span> <span class="nf">run</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Starting the client</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"-------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="cm">/* TODO: invoke the RPC function */</span>
    <span class="cm">/* hint 1: the name of the function to invoke is a composition of an interface name and a function name:
     * i.e.: &lt;interface&gt;_&lt;function&gt;
     * hint 2: the interfaces available are defined by the component, e.g. in hello-1.camkes
     * hint 3: the function name is defined by the interface definition, e.g. in interfaces/HelloSimple.idl4
     * hint 4: so the function would be:  hello_say_hello()
     * hint 5: look at https://github.com/seL4/camkes-tool/blob/master/docs/index.md#creating-an-application
     */</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">shello</span> <span class="o">=</span> <span class="s">"hello world"</span><span class="p">;</span>
    <span class="n">hello_say_hello</span><span class="p">(</span><span class="n">shello</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"After the client</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="task-5">TASK 5</h3>
<p>Here you define the callee-side invocation functions for
the Hello interface exposed by Echo.</p>

<h2 id="done">Done</h2>

<p>Now build and run the project, if it compiles: Congratulations! Be sure to read up on the keywords and
structure of ADL: it’s key to understanding CAmkES. And well done on
writing your first CAmkES application.</p>

<hr />
<h2 id="getting-help">Getting help</h2>
<p>Stuck? See the resources below.</p>
<ul>
  <li><a href="https://docs.sel4.systems/FrequentlyAskedQuestions">FAQ</a></li>
  <li><a href="http://sel4.systems/Info/Docs/seL4-manual-latest.pdf">seL4 Manual</a></li>
  <li><a href="https://docs.sel4.systems/DebuggingGuide.html">Debugging guide</a></li>
  <li><a href="https://sel4.discourse.group">seL4 Discourse forum</a></li>
  <li><a href="https://lists.sel4.systems/postorius/lists/devel.sel4.systems/">Developer’s mailing list</a></li>
  <li><a href="https://mattermost.trustworthy.systems/sel4-external/">Mattermost Channel</a></li>
</ul>

<hr />

<p><em>Tutorial included from <a href="https://github.com/sel4/sel4-tutorials/blob/master/tutorials/
hello-camkes-1/hello-camkes-1.md">github repo</a> <a href="https://github.com/sel4/sel4-tutorials/edit/master/tutorials/
hello-camkes-1/hello-camkes-1.md">edit</a></em></p>


    </div>
  </div>
</div>

    </main>
    


<footer class="site-footer">

  <h2 class="footer-heading">seL4 docs</h2>

  <div class="footer-col-wrapper">

    <div class="col-md-2">
      



<ul class="social-media-list">
  <li><a href="https://github.com/sel4"><i class="fab fa-github"></i> <span class="username">sel4</span></a></li><li><a href="https://github.com/sel4proj"><i class="fab fa-github"></i> <span class="username">sel4proj</span></a></li>
</ul>

    </div>

    <div class="col-md-8">
      <ul class="list-unstyled">
        <li>
          This site is for displaying seL4 related documentation.  Pull requests are welcome.
        </li>
        
          <li>
            Site last updated: Mon Sep 23 12:58:08 2024 +0200 7c251159a6
          </li>
          <li>
                Page last updated: Mon Nov 30 09:25:37 2020 +1100 977ed44f17
          </li>
        
      </ul>
    </div>
    <div class="col-md-2">
<a href="https://github.com/seL4/docs/blob/master/Tutorials/hello-camkes-1.md">View page on GitHub</a>
      <br />
      <a href="https://github.com/seL4/docs/edit/master/Tutorials/hello-camkes-1.md">Edit page on GitHub</a>
      <br />
      <a href="/sitemap">Sitemap</a>
    </div>

  </div>

</footer>

  </body>
</html>
